name: flake8 Lint and Dependent Job

on: [push, pull_request]

jobs:
  flake8-lint:
    runs-on: ubuntu-latest
    name: Lint
    steps:
      - name: Check out source repository
        uses: actions/checkout@v3
      - name: Set up Python environment
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"
      - name: flake8 Lint
        uses: py-actions/flake8@v2

  push-to-docker:
    needs: flake8-lint
    runs-on: ubuntu-latest
    name: Push to Docker Hub
    steps:
      - name: Check out source repository
        uses: actions/checkout@v3
      - name: Log in to Docker Hub
        uses: docker/login-action@v2
        with:
          username: emrekonak
          password: ${{ secrets.docker_token }}
      - name: Build and push Docker image
        uses: docker/build-push-action@v4
        with:
          context: .
          push: true
          tags: emrekonak/python-test:${{ github.sha }}
